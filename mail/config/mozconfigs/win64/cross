. "$topsrcdir/comm/build/mozconfig.comm-sccache"
. "$topsrcdir/build/mozconfig.win-common"
. "$topsrcdir/build/mozconfig.common"
. "$topsrcdir/build/mozconfig.stylo"
. "$topsrcdir/comm/mail/config/mozconfigs/common"
. "$topsrcdir/comm/mail/config/mozconfigs/win64/common-win64"

ac_add_options --enable-update-channel="${MOZ_UPDATE_CHANNEL}"
ac_add_options --enable-profiling

# Needed to enable breakpad in application.ini
export MOZILLA_OFFICIAL=1

export MOZ_TELEMETRY_REPORTING=1

# Disable enforcing that add-ons are signed by the trusted root
MOZ_REQUIRE_ADDON_SIGNING=0

# Package js shell
export MOZ_PACKAGE_JSSHELL=1

. $topsrcdir/build/win64/mozconfig.vs-latest

# Set up mapi includes (must be done after visual studio setup)
export INCLUDE=$TOOLTOOL_DIR/mapiheader


ac_add_options --with-branding=comm/mail/branding/nightly

# Configure expects executables for check_prog, so set the relevant files
# as executable on the first evaluation of the mozconfig where they exist.
if [ -d "${VSPATH}" -a ! -x "${VSPATH}/VC/bin/Hostx64/x64/cl.exe" ]; then
    find "${VSPATH}" -type f -name \*.exe -exec chmod +x {} \;
fi
export MAKENSISU="${MOZ_FETCHES_DIR}/nsis-3.01/makensis.exe"
if [ -d "${MAKENSISU%/*}" -a ! -x "${MAKENSISU}" ]; then
    chmod +x "${MAKENSISU}"
fi
export MAKECAB="${TOOLTOOL_DIR}/makecab.exe"
if [ -f "${MAKECAB}" ]; then
    chmod +x "${MAKECAB}"
fi
export UPX="${MOZ_FETCHES_DIR}/upx-3.95-win64/upx.exe"
if [ -f "${UPX}" ]; then
    chmod +x "${UPX}"
fi
CLANG_CL_EXE_DIR="${MOZ_FETCHES_DIR}/clang-cl/clang/bin"
if [ -d "${CLANG_CL_EXE_DIR}" ]; then
    chmod +x "${CLANG_CL_EXE_DIR}/clang-cl.exe"
fi
export WINE=${MOZ_FETCHES_DIR}/wine/bin/wine64
export RC=rc.exe
export MIDL=midl.exe
mk_add_options "export PATH=${TOOLTOOL_DIR}/vs2017_15.8.4/VC/bin/Hostx64/x64:${MOZ_FETCHES_DIR}/nsis-3.01:${CLANG_CL_EXE_DIR}:${PATH}"

unset VC_PATH
