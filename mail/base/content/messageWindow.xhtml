<?xml version="1.0"?>
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

#filter substitution

<!DOCTYPE html [
<!ENTITY % brandDTD SYSTEM "chrome://branding/locale/brand.dtd" >
%brandDTD;
<!ENTITY % msgHdrViewOverlayDTD SYSTEM "chrome://messenger/locale/msgHdrViewOverlay.dtd">
%msgHdrViewOverlayDTD;
<!ENTITY % messengerDTD SYSTEM "chrome://messenger/locale/messenger.dtd" >
%messengerDTD;
<!ENTITY % customizeToolbarDTD SYSTEM "chrome://messenger/locale/customizeToolbar.dtd">
%customizeToolbarDTD;
<!ENTITY % utilityDTD SYSTEM "chrome://communicator/locale/utilityOverlay.dtd">
%utilityDTD;
<!ENTITY % msgViewPickerDTD SYSTEM "chrome://messenger/locale/msgViewPickerOverlay.dtd" >
%msgViewPickerDTD;
<!ENTITY % baseMenuOverlayDTD SYSTEM "chrome://messenger/locale/baseMenuOverlay.dtd">
%baseMenuOverlayDTD;
<!ENTITY % utilityDTD SYSTEM "chrome://communicator/locale/utilityOverlay.dtd">
%utilityDTD;
<!ENTITY % viewZoomOverlayDTD SYSTEM "chrome://messenger/locale/viewZoomOverlay.dtd">
%viewZoomOverlayDTD;
<!ENTITY % msgViewPickerDTD SYSTEM "chrome://messenger/locale/msgViewPickerOverlay.dtd" >
%msgViewPickerDTD;
<!ENTITY % lightningDTD SYSTEM "chrome://lightning/locale/lightning.dtd">
%lightningDTD;
<!ENTITY % calendarDTD SYSTEM "chrome://calendar/locale/calendar.dtd" >
%calendarDTD;
<!ENTITY % calendarMenuOverlayDTD SYSTEM "chrome://calendar/locale/menuOverlay.dtd" >
%calendarMenuOverlayDTD;
<!ENTITY % toolbarDTD SYSTEM "chrome://lightning/locale/lightning-toolbar.dtd">
%toolbarDTD;
<!ENTITY % eventDialogDTD SYSTEM "chrome://calendar/locale/calendar-event-dialog.dtd" >
%eventDialogDTD;
<!ENTITY % smimeDTD SYSTEM "chrome://messenger-smime/locale/msgReadSecurityInfo.dtd">
%smimeDTD;
]>

<!--
  - This window displays a single message.
  -->
<html id="messengerWindow" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
      xmlns:html="http://www.w3.org/1999/xhtml"
      icon="messengerWindow"
      scrolling="false"
      titlemodifier="&titledefault.label;@PRE_RELEASE_SUFFIX@"
      titlemenuseparator="&titleSeparator.label;"
      persist="width height screenX screenY sizemode"
      toggletoolbar="true"
      windowtype="mail:messageWindow"
#ifdef XP_MACOSX
      macanimationtype="document"
      chromemargin="0,-1,-1,-1"
#endif
      lightweightthemes="true"
      fullscreenbutton="true">
<head>
  <title>&titledefault.label;@PRE_RELEASE_SUFFIX@</title>
  <link rel="stylesheet" href="chrome://messenger/skin/messageWindow.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/popupPanel.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/messageHeader.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/icons.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/colors.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/folderMenus.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/attachmentList.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/searchBox.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/panelUI.css" />
  <link rel="stylesheet" href="chrome://messenger/skin/contextMenu.css" />
  <link rel="stylesheet" href="chrome://calendar/skin/calendar.css" />
  <link
    rel="stylesheet"
    href="chrome://calendar/skin/shared/calendar-toolbar.css"
  />
  <link
    rel="stylesheet"
    href="chrome://messenger/skin/openpgp/inlineNotification.css"
  />

  <link rel="localization" href="branding/brand.ftl" />
  <link rel="localization" href="messenger/messenger.ftl" />
  <link rel="localization" href="toolkit/main-window/findbar.ftl" />
  <link rel="localization" href="toolkit/global/textActions.ftl" />
  <link rel="localization" href="toolkit/printing/printUI.ftl" />
  <link rel="localization" href="messenger/menubar.ftl" />
  <link rel="localization" href="messenger/appmenu.ftl" />
  <link rel="localization" href="messenger/openpgp/openpgp.ftl" />
  <link rel="localization" href="messenger/openpgp/openpgp-frontend.ftl" />

  <script defer="defer" src="chrome://messenger/content/globalOverlay.js"></script>
  <script defer="defer" src="chrome://messenger/content/mailWindow.js"></script>
  <script defer="defer" src="chrome://messenger/content/messageWindow.js"></script>
  <script defer="defer" src="chrome://global/content/contentAreaUtils.js"></script>
  <script defer="defer" src="chrome://messenger/content/browserPopups.js"></script>
  <script defer="defer" src="chrome://messenger/content/toolbarIconColor.js"></script>
  <script defer="defer" src="chrome://messenger/content/mailCommands.js"></script>
  <script defer="defer" src="chrome://messenger/content/mailWindowOverlay.js"></script>
  <script defer="defer" src="chrome://messenger-newsblog/content/newsblogOverlay.js"></script>
  <script defer="defer" src="chrome://messenger/content/mail-offline.js"></script>
  <script defer="defer" src="chrome://messenger/content/viewZoomOverlay.js"></script>
  <script defer="defer" src="chrome://communicator/content/utilityOverlay.js"></script>
  <script defer="defer" src="chrome://messenger/content/mailCore.js"></script>
#ifdef NIGHTLY_BUILD
  <script defer="defer" src="chrome://messenger/content/sync.js"></script>
#endif
  <script defer="defer" src="chrome://messenger/content/panelUI.js"></script>
  <script defer="defer" src="chrome://messenger/content/chat/toolbarbutton-badge-button.js"></script>
  <script defer="defer" src="chrome://messenger/content/messenger-customization.js"></script>
#ifdef XP_MACOSX
  <script defer="defer" src="chrome://global/content/macWindowMenu.js"></script>
#endif
  <script defer="defer" src="chrome://messenger/content/customizable-toolbar.js"></script>
  <script defer="defer" src="chrome://calendar/content/calendar-chrome-startup.js"></script>
  <script defer="defer" src="chrome://calendar/content/calendar-management.js"></script>
  <script defer="defer" src="chrome://calendar/content/calendar-item-editing.js"></script>
  <script defer="defer" src="chrome://calendar/content/calendar-extract.js"></script>
</head>
<html:body xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">

  <stringbundle id="bundle_brand" src="chrome://branding/locale/brand.properties"/>
  <stringbundle id="bundle_messenger" src="chrome://messenger/locale/messenger.properties"/>

  <commandset id="mailCommands">
#include mainCommandSet.inc.xhtml
    <commandset id="mailSearchMenuItems"/>
    <commandset id="attachmentCommands">
      <command id="cmd_openAllAttachments"
               oncommand="goDoCommand('cmd_openAllAttachments');"/>
      <command id="cmd_saveAllAttachments"
               oncommand="goDoCommand('cmd_saveAllAttachments');"/>
      <command id="cmd_detachAllAttachments"
               oncommand="goDoCommand('cmd_detachAllAttachments');"/>
      <command id="cmd_deleteAllAttachments"
               oncommand="goDoCommand('cmd_deleteAllAttachments');"/>
    </commandset>
    <commandset id="tasksCommands">
      <command id="cmd_newMessage" oncommand="goOpenNewMessage();"/>
      <command id="cmd_newCard" oncommand="openNewCardDialog()"/>
    </commandset>
    <commandset id="commandKeys"/>
    <command id="cmd_close" oncommand="window.close();"/>
  </commandset>

  <keyset id="mailKeys">
    <key keycode="VK_ESCAPE" oncommand="window.close();"/>
#include mainKeySet.inc.xhtml
    <keyset id="tasksKeys">
#ifdef XP_MACOSX
      <key id="key_newMessage" key="&newMessageCmd.key;" command="cmd_newMessage"
           modifiers="accel,shift"/>
      <key id="key_newMessage2" key="&newMessageCmd2.key;" command="cmd_newMessage"
           modifiers="accel"/>
#else
      <key id="key_newMessage"  key="&newMessageCmd.key;" command="cmd_newMessage"
           modifiers="accel"/>
      <key id="key_newMessage2" key="&newMessageCmd2.key;" command="cmd_newMessage"
           modifiers="accel"/>
#endif
    </keyset>
  </keyset>

  <popupset id="mainPopupSet">
#include widgets/browserPopups.inc.xhtml
#include widgets/toolbarContext.inc.xhtml
<!-- The panelUI is for the appmenu. -->
#include ../../components/customizableui/content/panelUI.inc.xhtml
  </popupset>

  <toolbox id="mail-toolbox"
           class="mail-toolbox"
           mode="full"
           defaultmode="full"
#ifdef XP_MACOSX
           iconsize="small"
           defaulticonsize="small"
#endif
           labelalign="end"
           defaultlabelalign="end">
#ifdef XP_MACOSX
    <hbox id="titlebar">
      <hbox id="titlebar-title" align="center" flex="1">
        <label id="titlebar-title-label" value="&titledefault.label;" flex="1" crop="end"/>
      </hbox>
#include messenger-titlebar-items.inc.xhtml
    </hbox>
#endif
    <!-- Menu -->
    <toolbar is="customizable-toolbar" id="toolbar-menubar"
             class="chromeclass-menubar themeable-full"
             type="menubar"
             customizable="true"
             toolboxid="mail-toolbox"
#ifdef XP_MACOSX
             defaultset="menubar-items"
             autohide="true"
#else
             defaultset="menubar-items,spring"
#endif
#ifndef XP_MACOSX
             data-l10n-id="toolbar-context-menu-menu-bar"
             data-l10n-attrs="toolbarname"
#endif
             context="toolbar-context-menu"
             mode="icons"
             insertbefore="tabs-toolbar"
             prependmenuitem="true">
      <toolbaritem id="menubar-items" align="center">
# The entire main menubar is placed into messenger-menubar.inc.xhtml, so that it
# can be shared with other top level windows.
#include messenger-menubar.inc.xhtml
      </toolbaritem>
    </toolbar>
    <!-- mail-toolbox with the main toolbarbuttons -->
    <toolbarpalette id="MailToolbarPalette">
      <toolbarbutton is="toolbarbutton-menu-button" id="button-getmsg"
                     type="menu"
                     class="toolbarbutton-1"
                     label="&getMsgButton1.label;"
                     tooltiptext="&getMsgButton.tooltip;"
                     command="cmd_getNewMessages">
        <menupopup is="folder-menupopup" id="button-getMsgPopup"
                   onpopupshowing="getMsgToolbarMenu_init();"
                   oncommand="MsgGetMessagesForAccount(event.target._folder); event.stopPropagation();"
                   expandFolders="false"
                   mode="getMail">
          <menuitem id="button-getAllNewMsg"
                    class="menuitem-iconic folderMenuItem"
                    label="&getAllNewMsgCmd.label;"
                    accesskey="&getAllNewMsgCmd.accesskey;"
                    command="cmd_getMsgsForAuthAccounts"/>
          <menuseparator id="button-getAllNewMsgSeparator"/>
        </menupopup>
      </toolbarbutton>
      <toolbarbutton id="button-newmsg"
                     class="toolbarbutton-1"
                     label="&newMsgButton.label;"
                     tooltiptext="&newMsgButton.tooltip;"
                     command="cmd_newMessage"/>
      <toolbarbutton id="button-file"
                     type="menu"
                     wantdropmarker="true"
                     class="toolbarbutton-1"
                     label="&fileButton.label;"
                     tooltiptext="&fileButton.tooltip;"
                     oncommand="goDoCommand('cmd_moveMessage', event.target._folder)">
        <menupopup is="folder-menupopup" id="button-filePopup"
                   mode="filing"
                   showRecent="true"
                   showFileHereLabel="true"
                   recentLabel="&moveCopyMsgRecentMenu.label;"
                   recentAccessKey="&moveCopyMsgRecentMenu.accesskey;"/>
      </toolbarbutton>
      <toolbarbutton id="button-showconversation"
                     class="toolbarbutton-1"
                     label="&openConversationButton.label;"
                     tooltiptext="&openMsgConversationButton.tooltip;"
                     command="cmd_openConversation"/>
      <toolbarbutton is="toolbarbutton-menu-button" id="button-goback"
                     type="menu"
                     class="toolbarbutton-1"
                     label="&backButton1.label;"
                     command="cmd_goBack"
                     tooltiptext="&goBackButton.tooltip;">
        <menupopup id="button-goBackPopup" onpopupshowing="backToolbarMenu_init(this)">
          <menuitem id="button-goBack" label="&goBackCmd.label;" command="cmd_goBack"/>
          <menuseparator id="button-goBackSeparator"/>
        </menupopup>
      </toolbarbutton>
      <toolbarbutton is="toolbarbutton-menu-button" id="button-goforward"
                     type="menu"
                     class="toolbarbutton-1"
                     label="&goForwardButton1.label;"
                     command="cmd_goForward"
                     tooltiptext="&goForwardButton.tooltip;">
        <menupopup id="button-goForwardPopup" onpopupshowing="forwardToolbarMenu_init(this)">
          <menuitem id="button-goForward"
                    label="&goForwardCmd.label;"
                    command="cmd_goForward"/>
          <menuseparator id="button-goForwardSeparator"/>
        </menupopup>
      </toolbarbutton>
      <toolbaritem id="button-previous"
                   title="&previousButtonToolbarItem.label;"
                   align="center"
                   class="chromeclass-toolbar-additional">
        <toolbarbutton id="button-previousUnread"
                       class="toolbarbutton-1"
                       label="&previousButton.label;"
                       command="cmd_previousUnreadMsg"
                       tooltiptext="&previousButton.tooltip;"/>
      </toolbaritem>
      <toolbarbutton id="button-previousMsg"
                     class="toolbarbutton-1"
                     label="&previousMsgButton.label;"
                     command="cmd_previousMsg"
                     tooltiptext="&previousMsgButton.tooltip;"/>
      <toolbaritem id="button-next"
                   title="&nextButtonToolbarItem.label;"
                   align="center"
                   class="chromeclass-toolbar-additional">
        <toolbarbutton id="button-nextUnread"
                       class="toolbarbutton-1"
                       label="&nextButton.label;"
                       command="cmd_nextUnreadMsg"
                       tooltiptext="&nextButton.tooltip;"/>
      </toolbaritem>
      <toolbarbutton id="button-nextMsg"
                     class="toolbarbutton-1"
                     label="&nextMsgButton.label;"
                     command="cmd_nextMsg"
                     tooltiptext="&nextMsgButton.tooltip;"/>
      <toolbarbutton id="button-print"
                     class="toolbarbutton-1"
                     label="&printButton.label;"
                     command="cmd_print"
                     tooltiptext="&printButton.tooltip;"/>
      <toolbarbutton is="toolbarbutton-menu-button" id="button-mark"
                     type="menu"
                     class="toolbarbutton-1"
                     label="&markButton.label;"
                     tooltiptext="&markButton.tooltip;">
        <menupopup id="button-markPopup" onpopupshowing="InitMessageMark()">
          <menuitem id="markReadToolbarItem"
                    label="&markAsReadCmd.label;"
                    accesskey="&markAsReadCmd.accesskey;"
                    key="key_toggleRead"
                    command="cmd_markAsRead"/>
          <menuitem id="markUnreadToolbarItem"
                    label="&markAsUnreadCmd.label;"
                    accesskey="&markAsUnreadCmd.accesskey;"
                    key="key_toggleRead"
                    command="cmd_markAsUnread"/>
          <menuitem id="button-markThreadAsRead"
                    label="&markThreadAsReadCmd.label;"
                    key="key_markThreadAsRead"
                    accesskey="&markThreadAsReadCmd.accesskey;"
                    command="cmd_markThreadAsRead"/>
          <menuitem id="button-markReadByDate"
                    label="&markReadByDateCmd.label;"
                    key="key_markReadByDate"
                    accesskey="&markReadByDateCmd.accesskey;"
                    command="cmd_markReadByDate"/>
          <menuitem id="button-markAllRead"
                    label="&markAllReadCmd.label;"
                    key="key_markAllRead"
                    accesskey="&markAllReadCmd.accesskey;"
                    command="cmd_markAllRead"/>
          <menuseparator id="button-markAllReadSeparator"/>
          <menuitem id="markFlaggedToolbarItem"
                    type="checkbox"
                    label="&markStarredCmd.label;"
                    accesskey="&markStarredCmd.accesskey;"
                    key="key_toggleFlagged"
                    command="cmd_markAsFlagged"/>
        </menupopup>
      </toolbarbutton>
      <toolbarbutton id="button-tag"
                     type="menu"
                     wantdropmarker="true"
                     class="toolbarbutton-1"
                     label="&tagButton.label;"
                     tooltiptext="&tagButton.tooltip;"
                     command="cmd_tag">
        <menupopup id="button-tagpopup"
                   onpopupshowing="InitMessageTags(this);">
          <menuitem id="button-addNewTag"
                    label="&addNewTag.label;"
                    accesskey="&addNewTag.accesskey;"
                    command="cmd_addTag"/>
          <menuitem id="button-manageTags"
                    label="&manageTags.label;"
                    accesskey="&manageTags.accesskey;"
                    command="cmd_manageTags"/>
          <menuseparator id="button-tagpopup-sep-afterTagAddNew"/>
          <menuitem id="button-tagRemoveAll"
                    command="cmd_removeTags"/>
          <menuseparator id="button-afterTagRemoveAllSeparator"/>
        </menupopup>
      </toolbarbutton>
      <toolbarbutton id="button-address"
                     class="toolbarbutton-1"
                     label="&addressBookButton.label;"
                     oncommand="toAddressBook();"
                     tooltiptext="&addressBookButton.tooltip;"/>
      <toolbarbutton is="toolbarbutton-badge-button" id="button-chat"
                     image="chrome://messenger/skin/icons/new/compact/chat.svg"
                     class="toolbarbutton-1"
                     label="&chatButton.label;"
                     command="cmd_chat"
                     observes="cmd_chat"
                     tooltiptext="&chatButton.tooltip;"/>
      <toolbaritem id="throbber-box" title="&throbberItem.title;">
        <!-- NOTE: We only display up to one of these images at any given time.
           - Only show the static icon when customizing the toolbar.
           - Only show the animated icon when we are not customizing the toolbar
           - and there is some activity.
           - Once loading animation is handled by CSS, we can use a single image
           - here instead. -->
        <html:img class="animated-throbber-icon"
                  src="chrome://global/skin/icons/loading.png"
                  srcset="chrome://global/skin/icons/loading@2x.png 2x"
                  alt="" />
        <html:img class="static-throbber-icon"
                  src="chrome://messenger/skin/icons/notloading.png"
                  srcset="chrome://messenger/skin/icons/notloading@2x.png 2x"
                  alt="" />
      </toolbaritem>

      <toolbarbutton id="button-addons" class="toolbarbutton-1"
                     data-l10n-id="addons-and-themes-toolbarbutton"
                     oncommand="openAddonsMgr();"/>

      <toolbarbutton id="lightning-button-calendar"
                     class="toolbarbutton-1"
                     label="&lightning.toolbar.calendar.label;"
                     tooltiptext="&lightning.toolbar.calendar.tooltip;"
                     command="new_calendar_tab"/>
      <toolbarbutton id="lightning-button-tasks"
                     class="toolbarbutton-1"
                     label="&lightning.toolbar.task.label;"
                     tooltiptext="&lightning.toolbar.task.tooltip;"
                     command="new_task_tab"/>
      <toolbarbutton is="toolbarbutton-menu-button" id="extractEventButton"
                     type="menu"
                     class="toolbarbutton-1"
                     label="&calendar.extract.event.button;"
                     tooltiptext="&calendar.extract.event.button.tooltip;"
                     oncommand="calendarExtract.extractFromEmail(document.getElementById('messageBrowser').contentWindow.gMessage, true);">
        <menupopup id="extractEventLocaleList"
                   oncommand="calendarExtract.extractWithLocale(event, true);"
                   onpopupshowing="calendarExtract.onShowLocaleMenu(event.target);"/>
      </toolbarbutton>
      <toolbarbutton is="toolbarbutton-menu-button" id="extractTaskButton"
                     type="menu"
                     class="toolbarbutton-1"
                     label="&calendar.extract.task.button;"
                     tooltiptext="&calendar.extract.task.button.tooltip;"
                     oncommand="calendarExtract.extractFromEmail(document.getElementById('messageBrowser').contentWindow.gMessage, false);">
        <menupopup id="extractTaskLocaleList"
                   oncommand="calendarExtract.extractWithLocale(event, false);"
                   onpopupshowing="calendarExtract.onShowLocaleMenu(event.target);"/>
      </toolbarbutton>
    </toolbarpalette>

    <!-- If changes are made to the default set of toolbar buttons, you may need to rev the id
         of mail-bar in order to force the new default items to show up for users who customized their toolbar
         in earlier versions. Bumping the id means users will have to re-customize their toolbar!
    -->

    <toolbar is="customizable-toolbar" id="mail-bar3"
             class="inline-toolbar chromeclass-toolbar themeable-full"
             toolbarname="&showMessengerToolbarCmd.label;"
             accesskey="&showMessengerToolbarCmd.accesskey;"
             fullscreentoolbar="true" mode="full"
             customizable="true"
             context="toolbar-context-menu"
#ifdef XP_MACOSX
             iconsize="small"
             defaultset="button-getmsg,button-newmsg,spacer,button-tag,qfb-show-filter-bar,spring">
#else
             defaultset="button-getmsg,button-newmsg,separator,button-tag,qfb-show-filter-bar,spring">
#endif
    </toolbar>
  </toolbox>

  <stack flex="1" class="printPreviewStack">
    <browser id="messageBrowser"
             flex="1"
             src="about:message"
             autocompletepopup="PopupAutoComplete"
             messagemanagergroup="single-page"/>
  </stack>

  <panel id="customizeToolbarSheetPopup" noautohide="true">
    <iframe id="customizeToolbarSheetIFrame"
            style="&dialog.dimensions;"
            hidden="true"/>
  </panel>

  <hbox id="status-bar" class="statusbar chromeclass-status" role="status">
#include mainStatusbar.inc.xhtml
  </hbox>

#include tabDialogs.inc.xhtml
</html:body>
</html>
