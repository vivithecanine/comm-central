<?xml version="1.0"?>
<?xml-stylesheet href="chrome://global/skin/global.css" type="text/css"?>
<?xml-stylesheet href="chrome://messenger/skin/messenger.css" type="text/css"?>
<?xml-stylesheet href="chrome://openpgp/skin/enigmail.css" type="text/css"?>

<!--
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at https://mozilla.org/MPL/2.0/.
-->

<?xul-overlay href="chrome://global/content/globalOverlay.xhtml"?>
<?xul-overlay href="chrome://communicator/content/utilityOverlay.xhtml"?>

<!DOCTYPE window [
  <!ENTITY % brandDTD SYSTEM "chrome://branding/locale/brand.dtd" >
   %brandDTD;
  <!ENTITY % enigMailDTD SYSTEM "chrome://openpgp/content/strings/enigmail.dtd" >
  %enigMailDTD;
  <!ENTITY % utilDTD SYSTEM "chrome://communicator/locale/utilityOverlay.dtd">
   %utilDTD;
]>

<window id="enigmailKeyManager"
        title="&enigmail.keyMan.title;"
        xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
        xmlns:html="http://www.w3.org/1999/xhtml"
        onload="enigmailKeyManagerLoad();"
        height="450"
        width="700"
        windowtype="enigmail:KeyManager"
        persist="screenX screenY width height">

  <script type="application/x-javascript" src="chrome://global/content/globalOverlay.js"/>
  <script type="application/x-javascript" src="chrome://openpgp/content/ui/enigmailCommon.js"/>
  <script type="application/x-javascript" src="chrome://openpgp/content/ui/enigmailKeyManager.js"/>
  <script type="application/x-javascript" src="chrome://openpgp/content/ui/commonWorkflows.js" />

  <commandset id="tasksCommands"/>

  <command id="cmd_close" oncommand="window.close()"/>
  <command id="cmd_quit"/>
  <command id="cmd_enigmailDeleteKey" oncommand="enigmailDeleteKey()"/>

  <keyset id="winKeys">
    <key id="key_selectAll" key="&enigmail.keyMan.selectAll.key;"
         oncommand="enigmailSelectAllKeys()" modifiers="accel"/>

    <key id="key_keyDetails" key="&enigmail.keyMan.keyDetails.key;"
         oncommand="enigmailKeyDetails()" modifiers="accel"
         observes="bcOneKey"/>

    <key id="key_enigDelete"
         keycode="VK_DELETE"
         command="cmd_enigmailDeleteKey"/>
    <key id="key_close"/>
    <key id="key_quit"/>
  </keyset>

  <broadcasterset>
    <broadcaster id="bcNoKey" disabled="false"/>
    <broadcaster id="bcViewPhoto" disabled="false"/>
    <broadcaster id="bcEditKey" disabled="false"/>
    <broadcaster id="bcRevoke" disabled="false"/>
    <broadcaster id="bcOneKey" disabled="false"/>
    <broadcaster id="bcDeleteKey" disabled="false"/>
    <broadcaster id="bcClipbrd" disabled="false"/>
  </broadcasterset>

  <toolbar type="menubar">
    <menubar id="main-menubar">
      <menu id="menu_File" label="&enigmail.keyMan.fileMenu.label;"
            accesskey="&enigmail.keyMan.fileMenu.accesskey;">
        <menupopup id="menu_FilePopup" onpopupshowing="enigmailKeyMenu();">
          <menuitem id="importFromFile"
                    label="&enigmail.keyMan.importPublicFromFile.label;"
                    accesskey="&enigmail.keyMan.importPublicFromFile.accesskey;"
                    oncommand="EnigmailCommon_importKeysFromFile(false);"/>
          <menuitem id="importFromFile"
                    label="&enigmail.keyMan.importSecretFromFile.label;"
                    oncommand="EnigmailCommon_importKeysFromFile(true);"/>
          <menuitem id="exportKey" label="&enigmail.keyMan.exportToFile.label;"
                    observes="bcNoKey"
                    accesskey="&enigmail.keyMan.exportToFile.accesskey;"
                    oncommand="enigmailExportKeys();"/>
          <menuitem id="sendKey"
                    label="&enigmail.keyMan.sendKeys.label;"
                    accesskey="&enigmail.keyMan.sendKeys.accesskey;"
                    observes="bcNoKey"
                    oncommand="enigCreateKeyMsg();"/>
          <menuitem id="createMail"
                    label="&enigmail.keyMan.createMail.label;"
                    accesskey="&enigmail.keyMan.createMail.accesskey;"
                    observes="bcNoKey"
                    oncommand="createNewMail();"/>
          <menuseparator/>

          <menuitem id="refreshKeys"
                    label="&enigmail.keyMan.reload.label;"
                    accesskey="&enigmail.keyMan.reload.accesskey;"
                    oncommand="clearKeyCache();"/>

          <!-- add Close and Exit menu items -->
          <menuitem id="menu_close"/>
        </menupopup>
      </menu>

      <menu label="&enigmail.keyMan.editMenu.label;"
            accesskey="&enigmail.keyMan.editMenu.accesskey;">
        <menupopup onpopupshowing="enigmailKeyMenu();">

          <menuitem id="importFromClipbrd"
                    label="&enigmail.keyMan.importFromClipbrd.label;"
                    accesskey="&enigmail.keyMan.importFromClipbrd.accesskey;"
                    observes="bcClipbrd"
                    oncommand="enigmailImportFromClipbrd();"/>
          <menuitem id="importFromUrl"
                    label="&enigmail.keyMan.importFromUrl.label;"
                    accesskey="&enigmail.keyMan.importFromUrl.accesskey;"
                    oncommand="enigmailImportKeysFromUrl();"/>
          <menuitem id="copyToClipbrd"
                    label="&enigmail.keyMan.copyToClipbrd.label;"
                    accesskey="&enigmail.keyMan.copyToClipbrd.accesskey;"
                    observes="bcNoKey"
                    oncommand="enigmailCopyToClipbrd();"/>

          <menuseparator/>

          <!--
          <menuitem id="revokeKey"
                    label="&enigmail.keyMan.revokeKey.label;"
                    accesskey="&enigmail.keyMan.revokeKey.accesskey;"
                    observes="bcRevoke"
                    oncommand="enigmailRevokeKey()"/>
          -->

          <menuitem id="deleteKey"
                    label="&enigmail.keyMan.delKey.label;"
                    accesskey="&enigmail.keyMan.delKey.accesskey;"
                    key="key_enigDelete"
                    observes="bcNoKey"
                    oncommand="enigmailDeleteKey();"/>

          <!--
          <menuseparator/>
          <menuitem id="changeExpiry"
                    label="&enigmail.keyMan.changeExpiry.label;"
                    observes="bcEditKey"
                    accesskey="&enigmail.keyMan.changeExpiry.accesskey;"
                    oncommand="enigEditKeyExpiry();"/>
          -->

          <menuseparator/>

          <menuitem id="selectAll"
                    label="&enigmail.keyMan.selectAll.label;"
                    accesskey="&enigmail.keyMan.selectAll.accesskey;"
                    oncommand="enigmailSelectAllKeys()"
                    key="key_selectAll"/>

        </menupopup>
      </menu>

        <menu id="viewMenu"
              label="&enigmail.keyMan.viewMenu.label;"
              accesskey="&enigmail.keyMan.viewMenu.accesskey;">
        <menupopup onpopupshowing="enigmailKeyMenu()"> <!-- view menu -->
          <menuitem id="viewPhoto"
                    label="&enigmail.keyMan.viewPhoto.label;"
                    accesskey="&enigmail.keyMan.showPhoto.accesskey;"
                    observes="bcViewPhoto"
                    oncommand="enigShowPhoto();"/>
          <menuitem id="keyDetails"
                    label="&enigmail.keyMan.keyProps.label;"
                    accesskey="&enigmail.keyMan.keyDetails.accesskey;"
                    observes="bcOneKey"
                    key="key_keyDetails"
                    oncommand="enigmailKeyDetails();"/>
          <menuseparator/>
          <menuitem id="showInvalidKeys"
                    label="&enigmail.keyMan.showInvalidKeys.label;"
                    accesskey="&enigmail.keyMan.showInvalidKeys.accesskey;"
                    type="checkbox"
                    checked="true"
                    persist="checked"
                    oncommand="applyFilter();"/>
          <menuitem id="showUntrustedKeys"
                    label="&enigmail.keyMan.showUntrustedKeys.label;"
                    accesskey="&enigmail.keyMan.showUntrustedKeys.accesskey;"
                    type="checkbox"
                    checked="true"
                    persist="checked"
                    oncommand="applyFilter();"/>
          <menuitem id="showOthersKeys"
                    label="&enigmail.keyMan.showOthersKeys.label;"
                    accesskey="&enigmail.keyMan.showOthersKeys.accesskey;"
                    type="checkbox"
                    checked="true"
                    persist="checked"
                    oncommand="applyFilter();"/>
        </menupopup>
      </menu>

      <menu id="generateMenu"
            label="&enigmail.keyMan.generateMenu.label;"
            accesskey="&enigmail.keyMan.generateMenu.accesskey;">
        <menupopup onpopupshowing="enigmailKeyMenu();"> <!-- generate menu -->
          <menuitem id="genKey"
                    label="&enigmail.keyMan.generate.label;"
                    accesskey="&enigmail.keyMan.generate.accesskey;"
                    oncommand="EnigKeygen();"/>
          <!--
          <menuitem id="revokationCertificate"
                    label="&enigmail.keyMan.genRevoke.label;"
                    accesskey="&enigmail.keyMan.genRevoke.accesskey;"
                    observes="bcRevoke"
                    oncommand="enigCreateRevokeCert()"/>
          -->
        </menupopup>
      </menu>
    </menubar>
  </toolbar>

  <popupset>
    <menupopup id="ctxmenu"
           onpopupshowing="enigmailKeyMenu();">
      <menuitem label="&enigmail.keyMan.ctxCopyToClipbrd.label;"
                id="ctxCopyToClipbrd"
                oncommand="enigmailCopyToClipbrd()"/>
      <menuitem label="&enigmail.keyMan.ctxExportToFile.label;"
                id="ctxExport"
                oncommand="enigmailExportKeys()"/>
      <menuitem label="&enigmail.keyMan.sendKeys.label;"
                id="ctxSendKey"
                oncommand="enigCreateKeyMsg()"/>

      <menuseparator/>

      <!--
      <menuitem id="ctxRevokeKey" observes="bcRevoke" label="&enigmail.keyMan.revokeKey.label;" oncommand="enigmailRevokeKey()"/>
      -->
      <menuitem id="ctxDeleteKey" label="&enigmail.keyMan.delKey.label;" oncommand="enigmailDeleteKey()"/>

      <!--
      <menuseparator/>
      <menuitem id="ctxChangeExpiry" observes="bcEditKey" label="&enigmail.keyMan.changeExpiry.label;" oncommand="enigEditKeyExpiry()"/>
      <menuitem id="ctxRevokationCert" observes="bcRevoke" label="&enigmail.keyMan.ctxGenRevoke.label;" oncommand="enigCreateRevokeCert()"/>
      -->

      <menuseparator observes="bcEditKey"/>

      <menuitem id="ctxViewPhoto" observes="bcViewPhoto" label="&enigmail.keyMan.ctxViewPhoto.label;" oncommand="enigShowPhoto()"/>
      <menuitem id="ctxDetails" observes="bcOneKey" label="&enigmail.keyMan.keyProps.label;"
                oncommand="enigmailKeyDetails()"/>
    </menupopup>
  </popupset>

  <hbox flex="0" align="center">
    <html:input id="filterKey" size="35" placeholder="&enigmail.keyMan.filter.label;"/>
    <separator orient="vertical"/>
    <checkbox label="&enigmail.keyMan.showAllKeys.label;"
          checked="true"
          id="showAllKeys"
          accesskey="&enigmail.keyMan.showAllKeys.accesskey;"
          oncommand="enigmailToggleShowAll(this)"/>

  </hbox>

  <tooltip id="emptyTree" label="&enigmail.keyMan.emptyTree.tooltip;" noautohide="true"/>
  <tooltip id="nothingFound" label="&enigmail.keyMan.nothingFound.tooltip;" noautohide="true"/>
  <tooltip id="pleaseWait" label="&enigmail.keyMan.pleaseWait.tooltip;" noautohide="true"/>

  <vbox flex="1" class="enigmailGroupbox">
    <hbox flex="1">
      <tree id="pgpKeyList" flex="1"
        enableColumnDrag="true"
        seltype="multiple"
        persist="sortDirection sortResource"
        sortDirection="ascending"
        sortResource="enigUserNameCol"
        hidecolumnpicker="false">

        <treecols>
          <treecol id="enigUserNameCol" primary="true"
                  flex="1"
                  class="sortDirectionIndicator"
                  onclick="sortTree(this)"
                  label="&enigmail.keyMan.userId.label;"
                  style="width: 400px"
                  persist="width ordinal hidden"/>
          <splitter class="tree-splitter"/>
          <treecol id="keyCol" style="width:100px"
                   label="&enigmail.keyId.label;"
                   flex="1"
                   class="sortDirectionIndicator"
                   onclick="sortTree(this)"
                   persist="width ordinal hidden"/>
          <splitter class="tree-splitter"/>
          <treecol id="expCol" style="width:70px"
                   label="&enigmail.keyExpiry.label;"
                   flex="1"
                   class="sortDirectionIndicator"
                   onclick="sortTree(this)"
                   hidden="true"
                   persist="width ordinal hidden"/>
          <splitter class="tree-splitter"/>
          <treecol id="fprCol" style="width:70px"
                   label="&enigmail.keyMan.fingerprint.label;"
                   flex="1"
                   class="sortDirectionIndicator"
                   onclick="sortTree(this)"
                   hidden="true"
                   persist="width ordinal hidden"/>
        </treecols>

        <treechildren id="pgpKeyListChildren" properties=""
                      context="ctxmenu"/>

      </tree>
    </hbox>
  </vbox>

  <hbox id="statusLine">
    <label id="statusText" value=" "/>
    <html:progress id="progressBar" style=":indeterminate; visibility:collapsed"/>
  </hbox>
</window>
